
DROP TABLE Movimento;



DROP TABLE Posicao;



DROP TABLE Carteira;



DROP TABLE Usuario;



DROP TABLE Historico;



DROP TABLE Papel;



CREATE TABLE Carteira
(
	IdCarteira           INT(10) NOT NULL,
	IdUsuario            int(10) NULL,
	ValorAtual           decimal(14,6) NULL,
	NomeCarteira         VARCHAR(50) NULL,
	RiscoPorPosicao      decimal(14,6) NULL,
	RiscoPorCarteira     decimal(14,6) NULL,
	CustoOperacaoPadrao  decimal(14,6) NULL,
	ValorLiquido         decimal(14,6) NULL
);



ALTER TABLE Carteira
ADD PRIMARY KEY (IdCarteira);



ALTER TABLE Carteira
MODIFY IdCarteira INT(10) AUTO_INCREMENT;

insert into Carteira (IdUsuario,ValorAtual,NomeCarteira,RiscoPorPosicao,RiscoPorCarteira,CustoOperacaoPadrao,ValorLiquido) values (1,1000,'Carteira Padrão',2,6,20,1000);

insert into Carteira (IdUsuario,ValorAtual,NomeCarteira,RiscoPorPosicao,RiscoPorCarteira,CustoOperacaoPadrao,ValorLiquido) values (1,1234.56,'Carteira Teste 2',10,6,120,1234.56);



CREATE TABLE Historico
(
	idHistorico          int(10) NOT NULL,
	Open                 decimal(14,6) NULL,
	Close                decimal(14,6) NULL,
	High                 decimal(14,6) NULL,
	Low                  decimal(14,6) NULL,
	Volume               decimal(14,6) NULL,
	Data                 DATE NULL,
	IdPapel              int(10) NULL
);



ALTER TABLE Historico
ADD PRIMARY KEY (idHistorico);



ALTER TABLE Historico
MODIFY IdHistorico INT(10) AUTO_INCREMENT;



CREATE TABLE Movimento
(
	IdCarteira           INT(10) NULL,
	IdMovimento          int(10) NOT NULL,
	ValorMovimento       decimal(14,6) NULL,
	IdPosicao            int(10) NULL,
	Descricao            VARCHAR(255) NULL
);



ALTER TABLE Movimento
ADD PRIMARY KEY (IdMovimento);



ALTER TABLE MOVIMENTO 
MODIFY IdMOVIMENTO  INT(10) AUTO_INCREMENT;

INSERT INTO MOVIMENTO (IDCARTEIRA,DESCRICAO,VALORMOVIMENTO,IDPOSICAO) VALUES (1,'TESTE MOVIMENTO',100,1);



CREATE TABLE Papel
(
	IdPapel              int(10) NOT NULL,
	Codigo               VARCHAR(20) NULL,
	Nome                 VARCHAR(20) NULL,
	ValorAtual           decimal(14,6) NULL,
	LotePadrao           int(6) NULL
);



ALTER TABLE Papel
ADD PRIMARY KEY (IdPapel);



ALTER TABLE Papel
MODIFY IdPapel INT(10) AUTO_INCREMENT;

insert into Papel(Codigo,Nome,ValorAtual,LotePadrao) values ('TST1','Teste 1',10,100);
insert into Papel(Codigo,Nome,ValorAtual,LotePadrao) values ('TST2','Teste 2',20,100);



CREATE TABLE Posicao
(
	IdPosicao            int(10) NOT NULL,
	PrecoEntrada         decimal(14,6) NULL,
	PrecoSaida           decimal(14,6) NULL,
	PrecoStopAtual       VARCHAR(20) NULL,
	Quantidade           int(6) NULL,
	IdPapel              int(10) NULL,
	IdUsuario            int(10) NULL,
	IdCarteira           INT(10) NULL,
	DataEntrada          DATE NULL,
	DataSaida            CHAR(18) NULL,
	ValorEntrada         decimal(14,6) NULL,
	PrecoStopInicial     decimal(14,6) NULL
);



ALTER TABLE Posicao
ADD PRIMARY KEY (IdPosicao);



ALTER TABLE Posicao 
MODIFY IdPosicao  INT(10) AUTO_INCREMENT;

insert into Posicao (ValorEntrada,PrecoEntrada,PrecoSaida,PrecoStopInicial,PrecoStopAtual,Quantidade,IdPapel,IdUsuario,IdCarteira,DataEntrada,DataSaida) values (1000,12,20,10,8,100,1,1,1,STR_TO_DATE('1-10-2017', '%d-%m-%Y'),null);
insert into Posicao (ValorEntrada,PrecoEntrada,PrecoSaida,PrecoStopInicial,PrecoStopAtual,Quantidade,IdPapel,IdUsuario,IdCarteira,DataEntrada,DataSaida) values (1500,15,20,5,4,100,2,1,1,STR_TO_DATE('15-11-2017', '%d-%m-%Y'),null);



CREATE TABLE Usuario
(
	IdUsuario            int(10) NOT NULL,
	NomeUsuario          VARCHAR(50) NULL
);



ALTER TABLE Usuario
ADD PRIMARY KEY (IdUsuario);



ALTER TABLE Usuario
MODIFY IdUsuario INT(10) AUTO_INCREMENT;

insert into Usuario(NomeUsuario) values ('Usuario Teste');



ALTER TABLE Carteira
ADD FOREIGN KEY R_3 (IdUsuario) REFERENCES Usuario (IdUsuario);



ALTER TABLE Carteira
ADD FOREIGN KEY R_6 (IdUsuario) REFERENCES Usuario (IdUsuario);



ALTER TABLE Historico
ADD FOREIGN KEY R_10 (IdPapel) REFERENCES Papel (IdPapel);



ALTER TABLE Movimento
ADD FOREIGN KEY R_7 (IdCarteira) REFERENCES Carteira (IdCarteira);



ALTER TABLE Movimento
ADD FOREIGN KEY R_8 (IdPosicao) REFERENCES Posicao (IdPosicao);



ALTER TABLE Posicao
ADD FOREIGN KEY R_2 (IdPapel) REFERENCES Papel (IdPapel);



ALTER TABLE Posicao
ADD FOREIGN KEY R_5 (IdUsuario) REFERENCES Usuario (IdUsuario);



ALTER TABLE Posicao
ADD FOREIGN KEY R_9 (IdCarteira) REFERENCES Carteira (IdCarteira);


